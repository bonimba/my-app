<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">


<dom-module id="user-card">
    <template>
        <style>
            :host {
                display: block;
                box-sizing: border-box;
            }

            #image{
                border-radius: 50%;
            }
        </style>

            <template is="dom-if" if="[[signedIn]]">
                <iron-localstorage name="accessToken" value="{{accessToken}}"></iron-localstorage>
                <iron-ajax
                        auto
                        url="https://www.googleapis.com/youtube/v3/channels"
                        params='[[params]]'
                        headers="[[headers]]"
                        handle-as="json"
                        last-response="{{profile}}"
                ></iron-ajax>
                <template is="dom-repeat" items="[[profile.items]]" as="item" >
                    <iron-image id="image" src="[[item.snippet.thumbnails.default.url]]"></iron-image>
                    <label for="image">[[item.snippet.title]]</label>
                </template>
            </template>

    </template>
    <script>
        Polymer({
            is: "user-card",
            properties: {
                accessToken:{
                    type: String,
                    value: ''
                },
                params:{
                    type: Object,
                    value: {"part":"snippet", "mine": true, "maxResults": 1}
                },

                parameters:{
                    computed: 'computedParameters(params, accessToken)'
                },

                headers:{
                    computed: 'computeHeader(accessToken)'
                },

                signedIn:{
                    type: Boolean,
                    value: false
                }
            },

            computedParameters(params, accessToken){
                var parameters = params;
                parameters.access_token = accessToken;
                return parameters;
            },

            computeHeader(accessToken){
                return {"Authorization": "Bearer "+ accessToken};
            },

            parseProfile(resp){
                if(resp){
                    this.profile = resp.detail.response.items[0];
                }
            }
        });
    </script>
</dom-module>