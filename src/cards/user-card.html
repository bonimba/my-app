<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">


<dom-module id="user-card">
    <template>
        <style>
            :host{
                display: block;
                box-sizing: border-box;
            }

            #image{
                border-radius: 50%;
            }

            label{
                font-size: large;
            }
        </style>

            <template is="dom-if" if="[[signedIn]]">
                <iron-localstorage name="accessToken" value="{{accessToken}}"></iron-localstorage>
                <iron-ajax
                        auto
                        url="https://www.googleapis.com/youtube/v3/channels"
                        params='[[params]]'
                        headers="[[headers]]"
                        handle-as="json"
                        on-response="parseProfile"
                ></iron-ajax>

                <iron-image id="image" src="[[profile.snippet.thumbnails.default.url]]"></iron-image>
                <br>
                <label for="image">[[profile.snippet.title]]</label>

            </template>

    </template>
    <script>
        Polymer({
            is: "user-card",
            properties: {
                accessToken:{
                    type: String,
                    value: ''
                },
                params:{
                    type: Object,
                    value: {"part":"snippet", "mine": true, "maxResults": 1}
                },

                parameters:{
                    computed: 'computedParameters(params, accessToken)'
                },

                headers:{
                    computed: 'computeHeader(accessToken)'
                },

                signedIn:{
                    type: Boolean,
                    value: false
                },

                username:{
                    type: String,
                    value: 'bonimba33733',
                    notify: true,
                    reflectToAttribute: true
                },

                profile:{
                    type: Object,
                    value: null,
                    notify: true
                }
            },

            computedParameters: function(params, accessToken){
                var parameters = params;
                parameters.access_token = accessToken;
                return parameters;
            },

            computeHeader: function(accessToken){
                return {"Authorization": "Bearer "+ accessToken};
            },

            parseProfile: function(resp){
                if(resp){
                    this.profile = resp.detail.response.items[0];
                    this.username = this.profile.snippet.title;
                }
            }
        });
    </script>
</dom-module>