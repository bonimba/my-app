<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">s

<dom-module id="youtube-data">

    <template>
        <template is="dom-if" if="[[signedIn]]">
            <iron-localstorage name="accessToken"
                               value="{{accessToken}}"
            ></iron-localstorage>

            <template is="dom-if" if="[[accessToken]]">
                <iron-ajax
                        auto
                        url="[[url]]"
                        params='[[computedParameters]]'
                        handle-as="json"
                        headers="[[headers]]"
                        last-response="{{response}}"
                ></iron-ajax>
            </template>
        </template>


    </template>

    <script>
        Polymer({
            is: 'youtube-data',
            properties: {
                base : {
                    type: String,
                    value: "https://www.googleapis.com/youtube/v3"
                },
                specific: {
                    type: String,
                    value: 'channels'
                },
                url: {
                    type: String,
                    computed: 'computeUrl(base, specific)'
                },
                params : {
                    type: Object,
                    value: {}
                },

                youtubeKey: {
                    type: String,
                    value: "AIzaSyDgsvYtLz-BuMYSLt_Zzhde5W9Kl1BnbLA"
                },

                computedParameters: {
                    type: Object,
                    computed: 'computeParameters(params, youtubeKey)'
                },
                response: {
                    type: Object,
                    value: {},
                    notify: true,
                    reflectToAttribute: true
                },

                headers:{
                    computed: 'computeHeader(accessToken)'
                },
                accessToken:{
                    type: String,
                    value: ''
                },

                signedIn:{
                    type: Boolean,
                    value: false,
                    notify: true
                }
            },

            computeHeader: function(accessToken){
                if(accessToken)
                return {"Authorization": "Bearer "+accessToken};
                return '';
            },

            computeUrl: function(base, specific){
                return [base, specific].join("/");
            },

            computeParameters: function(params, youtubeKey){
                var parameters = params;
                parameters.key = youtubeKey;

                return parameters;
            }

        });
    </script>
</dom-module>
