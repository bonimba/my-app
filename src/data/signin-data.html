<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/google-signin/google-signin-aware.html">

<dom-module id="signin-data">
    <template>
        <style>
            :host {
                display: block;
                box-sizing: border-box;
            }
        </style>

       <google-signin-aware
            client-id="[[clientId]]"
            scopes="[[scope]]"
            openid-prompt="[[prompt]]"
            need-additional-auth="true"
            on-google-signin-aware-success="signIn"
            on-google-signin-aware-error="signOut"
            on-google-signin-aware-signed-out="signOut"
            signed-in="{{signedIn}}"
        ></google-signin-aware>


    </template>
    <script>
        Polymer({
            is: "signin-data",
            properties: {
                scope:{
                    type: String,
                    value: 'profile https://www.googleapis.com/auth/youtube https://www.googleapis.com/auth/youtube.force-ssl',
                    readOnly: true
                },
                prompt: {
                    type: String,
                    value: 'select_account',
                    readOnly: true
                },
                signedIn:{
                    type: Boolean,
                    value: false,
                    notify: true,
                    observer: '_isAuthorized'
                }
            },

            signIn: function(resp) {
                if(resp){
                    var accessToken = JSON.stringify(resp.detail.access_token);
                    accessToken && localStorage.setItem('accessToken', accessToken);

                    //var expires = JSON.stringify(resp.detail.expires_at);
                    //localStorage.setItem('expiresAt', expires);
                }

                this.domHost.$.dialog.close();
            },
            signOut: function() {
                this.accessToken = null;
                localStorage.removeItem('accessToken');
            },
            _isAuthorized: function(){
                this.fire('iron-signal', {name: 'authorized', data: this.signedIn});
                localStorage.setItem('signedIn', this.signedIn);

            }

        });
    </script>
</dom-module>