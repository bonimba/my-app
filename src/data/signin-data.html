<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/google-signin/google-signin-aware.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../cards/user-card.html">

<dom-module id="signin-data">
    <template>
        <style>
            :host {
                display: block;
                box-sizing: border-box;
            }
        </style>

        <iron-localstorage name="accessToken"
                           value="{{accessToken}}"
        ></iron-localstorage>

        <google-signin
                id="signinElement"
                brand="google"
                raised="true"
                theme="dark"
                width="wide"
                height="wide"
                client-id="[[clientId]]"
                scopes="[[scope]]"
                on-google-signin-success="signInSuccess"
                on-google-signed-out="signedOut"></google-signin>


        <google-signin-aware
            client-id="[[clientId]]"
            scope="[[scope]]"
            openid-prompt="[[prompt]]"
            need-additional-auth="true"
            on-google-signin-aware-success="signIn"
            on-google-signin-aware-error="signOut"
            on-google-signin-aware-signed-out="signOut"
        ></google-signin-aware>


    </template>
    <script>
        Polymer({
            is: "signin-data",
            properties: {
                clientId:{
                    type: String,
                    value: "288236233563-3d2recbph673vlbtbihe2ii4dbhbpif7.apps.googleusercontent.com",
                    readOnly: true
                },
                scope:{
                    type: String,
                    value: 'https://www.googleapis.com/auth/youtube',
                    readOnly: true
                },
                prompt: {
                    type: String,
                    value: 'select_account',
                    readOnly: true
                },
                signedIn:{
                    type: Boolean,
                    value: false,
                    notify: true,
                    reflectToAttribute: true
                },

                accessToken:{
                    type: String,
                    value: '',
                    notify: true,
                    reflectToAttribute: true
                }

            },

            signIn(resp) {
                this.signedIn = true;
                this.accessToken = resp.detail.access_token;
            },
            signOut() {
                this.signedIn = false;
                this.accessToken = null;
            },

            signInSuccess() {
                this.signedIn = true;
                this.domHost.$.dialog.close();
            },

            signedOut() {
                this.signedIn = false;
            }
        });
    </script>
</dom-module>